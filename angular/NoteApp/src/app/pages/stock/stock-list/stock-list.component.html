<div class="page-section">
    <div class="toolbar">
        <div class="search-wrapper">
            <input type="text" class="search-input" placeholder="æœç´¢å•†å“åç§°ã€ç¼–å·..." [(ngModel)]="keyword"
                (input)="applyFilter()" />
        </div>
        <select class="sort-select" [(ngModel)]="sortKey" (change)="applySort()">
            <option value="">æ’åºæ–¹å¼</option>
            <option value="name-asc">ç¼–å· â†‘</option>
            <option value="name-desc">ç¼–å· â†“</option>
            <option value="stock-asc">åº“å­˜ â†‘</option>
            <option value="stock-desc">åº“å­˜ â†“</option>
            <option value="price-asc">å–ä»· â†‘</option>
            <option value="price-desc">å–ä»· â†“</option>
        </select>
        <!-- é¢œè‰²ç­›é€‰ -->
        <select class="filter-select" [(ngModel)]="selectedColor" (change)="applyFilter()">
            <option value="">å…¨éƒ¨é¢œè‰²</option>
            <option *ngFor="let c of colorList" [value]="c.id">{{ c.name }}</option>
        </select>
    </div>

    <div class="product-card" *ngFor="let item of paginatedProducts" [ngClass]="{ 'out-of-stock': item.stock === 0 }"
        (click)="toggleSelect(item.code)">


        <div class="row">

            <!-- å·¦ä¾§å›¾ç‰‡ + ç¼–å· -->
            <div class="left">
                <img *ngIf="item.imageUrl; else noImg" [src]="item.imageUrl" class="thumb" />
                <ng-template #noImg>
                    <div class="thumb no-img">æ— å›¾</div>
                </ng-template>

                <span class="code">{{ item.code }}</span>
                <span class="stock-tag" [ngClass]="getColor(item.stock)">{{ item.stock || 0 }} ä»¶</span>
            </div>

            <!-- ä¸­é—´ä¿¡æ¯ -->
            <div class="right-info">

                <div class="info-row">
                    <span>åç§°ï¼š</span><strong>{{ item.name }}</strong>
                </div>

                <!-- JAN + å‹å· åŒä¸€è¡Œ -->
                <div class="info-row double">
                    <div><span>JANï¼š</span>{{ item.janId }}</div>
                    <div><span>å‹å·ï¼š</span>{{ item.modleName }}</div>
                </div>


                <!-- åˆ†ç±» + é¢œè‰² åŒä¸€è¡Œ -->
                <div class="info-row double">
                    <div><span>åˆ†ç±»ï¼š</span>{{ item.categoryName }}</div>
                    <div><span>é¢œè‰²ï¼š</span>{{ item.colorName }}</div>
                </div>

                <!-- è¿›è´§ä»· + å‡ºè´§ä»· åŒè¡Œ -->
                <div class="info-row double">
                    <div><span>è¿›è´§ä»·ï¼š</span>Â¥{{ item.costPrice }}</div>
                    <div><span>å‡ºè´§ä»·ï¼š</span>Â¥{{ item.salePrice }}</div>
                </div>

            </div>


            <!-- å³ä¾§æŒ‰é’®ï¼šåªæœ‰é€‰æ‹©æ—¶æ˜¾ç¤º -->
            <div class="actions" *ngIf="selectedItemId === item.code">
                <button class="btn-in" (click)="openStockModal(item, 'in')">â• å…¥åº“</button>
                <button class="btn-out" (click)="openStockModal(item, 'out')">â– å‡ºåº“</button>
                <button class="btn-view" (click)="viewHistory(item.code); $event.stopPropagation()">ğŸ“„ è®°å½•</button>
            </div>

        </div>
    </div>
    <div class="stock-pagination">
        <button (click)="currentPage = currentPage - 1" [disabled]="currentPage === 1">
            Â« ä¸Šä¸€é¡µ
        </button>

        <ng-container *ngFor="let item of paginationItems">
            <button *ngIf="item !== '...'" class="page-btn" [class.active]="item === currentPage"
                (click)="goToPage(item)">
                {{ item }}
            </button>

            <span *ngIf="item === '...'" class="dots">â€¦</span>
        </ng-container>


        <button (click)="currentPage = currentPage + 1" [disabled]="currentPage === totalPages">
            ä¸‹ä¸€é¡µ Â»
        </button>

        <!-- é¡µæ•°ä¿¡æ¯ -->
        <span class="page-info">
            å…± {{ totalPages }} é¡µ
        </span>

        <!-- è·³è½¬ -->
        <span class="jump">
            åˆ°ç¬¬
            <input type="number" min="1" [max]="totalPages" [(ngModel)]="jumpPage">
            é¡µ
            <button (click)="goToPage(jumpPage)">ç¡®å®š</button>
        </span>
    </div>


</div>
<app-stock-adjust-modal *ngIf="showStockModal" [item]="currentItem" [actionType]="actionType"
    (submitted)="onStockSubmitted($event)" (closed)="onModalClose()"></app-stock-adjust-modal>