<div class="inventory-form">

    <!-- 🔹 顶部切换模式 -->
    <div class="mode-switch">
        <button [class.active]="mode==='product'" (click)="mode='product'">📦 商品登记</button>
        <button [class.active]="mode==='category'" (click)="mode='category'">🏷 分类管理</button>
        <button [class.active]="mode==='color'" (click)="mode='color'">🎨 颜色管理</button>
    </div>

    <hr>

    <!-- ░░░░ 商品登记区域 ░░░░ -->
    <form *ngIf="mode==='product'" [formGroup]="form" (ngSubmit)="onSubmit()">

        <div class="form-grid">

            <div>
                <label>商品编号</label>
                <input class="form-input" formControlName="code" disabled placeholder="自动生成">
            </div>

            <div>
                <label>商品名称 *</label>
                <input class="form-input" formControlName="name">
            </div>

            <div>
                <label>JAN *</label>
                <input class="form-input" formControlName="janId">
            </div>

            <div>
                <label>分类 *</label>
                <select class="form-input" formControlName="categoryId">
                    <option value="">请选择</option>
                    <option *ngFor="let d of categories" [value]="d.id">{{d.name}}</option>
                </select>
            </div>

            <div>
                <label>颜色 *</label>
                <select class="form-input" formControlName="colorId">
                    <option value="">请选择</option>
                    <option *ngFor="let c of colors" [value]="c.id">{{c.name}}</option>
                </select>
            </div>

            <div>
                <label>进货价 *</label>
                <input class="form-input" formControlName="costPrice">
            </div>

            <div>
                <label>销售价 *</label>
                <input class="form-input" formControlName="salePrice">
            </div>

        </div>

        <!-- 上传 -->
        <div class="upload-area">
            <label>商品图片</label>
            <input type="file" #filePicker accept="image/*" style="display:none" (change)="onFileSelected($event)" />

            <input type="file" #cameraInput accept="image/*" capture="environment" style="display:none"
                (change)="onFileSelected($event)" />

            <div class="upload-btns">
                <button type="button" class="btn-light" (click)="openPicker()">📁 相册</button>
                <button type="button" class="btn-light" (click)="openCamera()">📷 拍照</button>
            </div>

            <div *ngIf="previewUrl" class="preview-container">
                <img [src]="previewUrl" class="preview-img">
                <button type="button" class="remove-btn" (click)="clearImage()">✖</button>
            </div>
        </div>

        <div class="actions">
            <button class="btn-primary" type="submit" [disabled]="form.invalid">💾 保存</button>
            <button class="btn-secondary" type="button" routerLink="/products">取消</button>
        </div>

    </form>


    <!-- ░░░░ 分类管理区域 ░░░░ -->
    <div *ngIf="mode==='category'" class="manage-section">
        <h5>🏷 分类管理</h5>

        <!-- 输入新增 -->
        <div class="add-row">
            <input [(ngModel)]="newCategory" placeholder="输入分类名称" class="form-input">
            <button class="btn-primary" (click)="saveCategory()">＋ 添加</button>
           <button class="btn-secondary" type="button" routerLink="/products">取消</button>
        </div>

        <!-- 分类列表 -->
        <table class="setting-table">
            <tr>
                <th>分类名称</th>
                <th>操作</th>
            </tr>
            <tr *ngFor="let item of categories">
                <td>{{ item.name }}</td>
                <td>
                    <button class="btn-mini" (click)="deleteCategory(item.id)">🗑 删除</button>
                </td>
            </tr>
        </table>
    </div>


    <!-- ░░░░ 颜色管理区域 ░░░░ -->
    <div *ngIf="mode==='color'" class="manage-section">

        <h5>🎨 颜色管理</h5>

        <div class="add-row">
            <input [(ngModel)]="newColor" placeholder="输入颜色名称" class="form-input">
            <button class="btn-primary" (click)="saveColor()">＋ 添加</button>
            <button class="btn-secondary" type="button" routerLink="/products">取消</button>
        </div>

        <table class="setting-table">
            <tr>
                <th>颜色名称</th>
                <th>操作</th>
            </tr>

            <tr *ngFor="let c of colors">
                <td>{{ c.name }}</td>
                <td>
                    <button class="btn-mini" (click)="deleteColor(c.id)">🗑 删除</button>
                </td>
            </tr>
        </table>

    </div>

</div>