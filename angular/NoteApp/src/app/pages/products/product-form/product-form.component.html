<div class="inventory-form">

    <!-- 🔹 顶部切换模式 -->
    <div class="mode-switch">
        <button [class.active]="mode==='product'" (click)="mode='product'">📦 商品登记</button>
        <button [class.active]="mode==='category'" (click)="mode='category'">🏷 分类</button>
        <button [class.active]="mode==='color'" (click)="mode='color'">🎨 颜色</button>
        <button [class.active]="mode==='outbound'" (click)="mode='outbound'">🚚 出库仓 </button>
        <button [class.active]="mode==='modle'" (click)="mode='modle'">🧩 型号 </button>
    </div>

    <hr>

    <!-- ░░░░ 商品登记区域 ░░░░ -->
    <form *ngIf="mode==='product'" [formGroup]="form" (ngSubmit)="onSubmit()">

        <div class="form-grid">

            <div>
                <label>商品编号</label>
                <input class="form-input" formControlName="code" disabled placeholder="自动生成">
            </div>

            <div>
                <label>商品名称 *</label>
                <input class="form-input" formControlName="name"
                    [ngClass]="{'invalid': form.get('name')?.invalid && form.get('name')?.touched}">

                <!-- 错误信息 -->
                <div class="error" *ngIf="form.get('name')?.hasError('required') && form.get('name')?.touched">
                    商品名称不能为空
                </div>

                <div class="error" *ngIf="form.get('name')?.hasError('maxlength') && form.get('name')?.touched">
                    商品名称不能超过15个字符
                </div>
            </div>

            <div>
                <label>JAN</label>
                <input class="form-input" formControlName="janId">
            </div>

            <div>
                <label>分类 *</label>
                <select class="form-input" formControlName="categoryId"
                    [ngClass]="{'invalid': form.get('categoryId')?.invalid && form.get('categoryId')?.touched}">
                    <option value="">请选择</option>
                    <option *ngFor="let c of categories" [ngValue]="c.id">{{c.name}}</option>
                </select>

                <div class="error"
                    *ngIf="form.get('categoryId')?.hasError('required') && form.get('categoryId')?.touched">
                    必须选择分类
                </div>
            </div>

            <div>
                <label>颜色 *</label>
                <select class="form-input" formControlName="colorId">
                    <option value="">请选择</option>
                    <option *ngFor="let c of colors" [value]="c.id">{{c.name}}</option>
                </select>
            </div>
            <div>
                <label>型号</label>
                <select class="form-input" formControlName="modleId">
                    <option value="">请选择</option>
                    <option *ngFor="let m of modles" [value]="m.id">{{m.name}}</option>
                </select>
            </div>

            <div>
                <label>进货价 *</label>
                <input class="form-input" formControlName="costPrice"
                    [ngClass]="{'invalid': form.get('costPrice')?.invalid && form.get('costPrice')?.touched}">

                <div class="error"
                    *ngIf="form.get('costPrice')?.hasError('required') && form.get('costPrice')?.touched">
                    必填
                </div>

                <div class="error" *ngIf="form.get('costPrice')?.hasError('pattern') && form.get('costPrice')?.touched">
                    请输入正确的价格 (例如：120 或 120.50)
                </div>
            </div>

            <div>
                <label>销售价 *</label>
                <input class="form-input" formControlName="salePrice"
                    [ngClass]="{'invalid': form.get('salePrice')?.invalid && form.get('salePrice')?.touched}">

                <div class="error"
                    *ngIf="form.get('salePrice')?.hasError('required') && form.get('salePrice')?.touched">
                    必填
                </div>

                <div class="error" *ngIf="form.get('salePrice')?.hasError('pattern') && form.get('salePrice')?.touched">
                    请输入正确的价格 (例如：120 或 120.50)
                </div>
            </div>

        </div>

        <!-- 上传 -->
        <div class="upload-area">
            <label>商品图片</label>
            <input type="file" #filePicker accept="image/*" style="display:none" (change)="onFileSelected($event)" />

            <input type="file" #cameraInput accept="image/*" capture="environment" style="display:none"
                (change)="onFileSelected($event)" />

            <div class="upload-btns">
                <button type="button" class="btn-light" (click)="openPicker()">📁 相册</button>
                <button type="button" class="btn-light" (click)="openCamera()">📷 拍照</button>
            </div>

            <div *ngIf="previewUrl" class="preview-container">
                <img [src]="previewUrl" class="preview-img">
                <button type="button" class="remove-btn" (click)="clearImage()">✖</button>
            </div>
        </div>

        <div class="actions">
            <button class="btn-primary" type="submit" [disabled]="form.invalid">💾 保存</button>
            <button class="btn-secondary" type="button" routerLink="/products">取消</button>
        </div>

    </form>


    <!-- ░░░░ 分类管理区域 ░░░░ -->
    <div *ngIf="mode==='category'" class="manage-section">
        <h5>🏷 分类管理</h5>

        <!-- 输入新增 -->
        <div class="add-row">
            <input [(ngModel)]="newCategory" placeholder="输入分类名称" class="form-input">
            <button class="btn-primary" (click)="saveCategory()">添加</button>
            <button class="btn-secondary" type="button" routerLink="/products">取消</button>
        </div>

        <!-- 分类列表 -->
        <table class="setting-table">
            <tr>
                <th>分类名称</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
            <tr *ngFor="let item of categorieslist">
                <td>{{ item.name }}</td>
                <td>{{ item.active ? '启用中' : '禁用中' }}</td>
                <td>
                    <button class="btn-mini" [ngClass]="item.active ? 'btn-stop' : 'btn-start'"
                        (click)="toggleStatusCategory(item)">
                        {{ item.active ? '停用' : '启用' }}
                    </button>

                </td>
            </tr>
        </table>
    </div>


    <!-- ░░░░ 颜色管理区域 ░░░░ -->
    <div *ngIf="mode==='color'" class="manage-section">

        <h5>🎨 颜色管理</h5>

        <div class="add-row">
            <input [(ngModel)]="newColor" placeholder="输入颜色名称" class="form-input">
            <button class="btn-primary" (click)="saveColor()">添加</button>
            <button class="btn-secondary" type="button" routerLink="/products">取消</button>
        </div>

        <table class="setting-table">
            <tr>
                <th>颜色名称</th>
                <th>状态</th>
                <th>操作</th>
            </tr>

            <tr *ngFor="let c of colorslist">
                <td>{{ c.name }}</td>
                <td>{{ c.active ? '启用中' : '禁用中' }}</td>
                <td>
                    <button class="btn-mini" [ngClass]="c.active ? 'btn-stop' : 'btn-start'"
                        (click)="togColorgleStatus(c)">
                        {{ c.active ? '停用' : '启用' }}
                    </button>

                </td>
            </tr>
        </table>

    </div>


    <!-- ░░░░ 出库对象 ░░░░ -->
    <div *ngIf="mode==='outbound'" class="manage-section">

        <h5>🚚出库仓管理</h5>

        <div class="add-row">
            <input [(ngModel)]="newDispatch" placeholder="输入仓库名称" class="form-input">
            <button class="btn-primary" (click)="saveDispatch()">添加</button>
            <button class="btn-secondary" type="button" routerLink="/products">取消</button>
        </div>

        <table class="setting-table">
            <tr>
                <th>出库仓</th>
                <th>状态</th>
                <th>操作</th>
            </tr>

            <tr *ngFor="let d of dispatchilist">
                <td>{{ d.name }}</td>
                <td>{{ d.active ? '启用中' : '禁用中' }}</td>
                <td>
                    <button class="btn-mini" [ngClass]="d.active ? 'btn-stop' : 'btn-start'"
                        (click)="togdispatchleStatus(d)">
                        {{ d.active ? '停用' : '启用' }}
                    </button>

                </td>
            </tr>
        </table>

    </div>


    <!-- ░░░░ 型号对象 ░░░░ -->
    <div *ngIf="mode==='modle'" class="manage-section">

        <h5>🧩型号管理</h5>

        <div class="add-row">
            <input [(ngModel)]="newModle" placeholder="输入型号名称" class="form-input">
            <button class="btn-primary" (click)="saveModle()">添加</button>
            <button class="btn-secondary" type="button" routerLink="/products">取消</button>
        </div>

        <table class="setting-table">
            <tr>
                <th>型号</th>
                <th>状态</th>
                <th>操作</th>
            </tr>

            <tr *ngFor="let m of modlelist">
                <td>{{ m.name }}</td>
                <td>{{ m.active ? '启用中' : '禁用中' }}</td>
                <td>
                    <button class="btn-mini" [ngClass]="m.active ? 'btn-stop' : 'btn-start'"
                        (click)="togModleStatus(m)">
                        {{ m.active ? '停用' : '启用' }}
                    </button>

                </td>
            </tr>
        </table>

    </div>




</div>