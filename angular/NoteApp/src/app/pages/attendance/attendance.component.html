<div class="attendance-container">
  <!-- 顶部切换标签 -->
  <div class="tab-header">
    <div class="tab" [class.active]="currentTab === 'personal'" (click)="currentTab = 'personal'">
      👤 个人
    </div>
    <div class="tab" [class.active]="currentTab === 'group'" (click)="currentTab = 'group'; loadGroupMembers()">
      👥 组员
    </div>
  </div>

  <!-- 👤 个人页 -->
  <div *ngIf="currentTab === 'personal'">
    <div class="date" [ngClass]="{ datecolor: datecolor }">{{ currentDate }}</div>
    <div class="time">{{ currentTime }}</div>

    <span *ngIf="isHoliday" class="holiday-text">🎉 祝日：{{ holidayName }}</span>

    <label *ngIf="datecolor && !isHoliday" class="weekend-check">
      <input type="checkbox" (click)="weekendWork()" /> 休息日出勤
    </label>

    <!-- 出勤按钮区 -->
    <div class="buttons">
      <button class="btn" [disabled]="isLoadingRecord || isDisabled('出勤')" (click)="onAttend('出勤')">出勤</button>
      <button class="btn" [disabled]="isLoadingRecord || isDisabled('中途退勤')" (click)="onAttend('中途退勤')">中途退勤</button>
      <button class="btn" [disabled]="isLoadingRecord || isDisabled('中途出勤')" (click)="onAttend('中途出勤')">中途出勤</button>
      <button class="btn" [disabled]="isLoadingRecord || isDisabled('退勤')" (click)="onAttend('退勤')">退勤</button>
    </div>

    <!-- ✅ 出勤记录 -->
    <div class="attendance-list" *ngIf="todayRecord">
      <h4>今日出勤记录</h4>
      <ul class="simple-list">
        <li *ngIf="todayRecord.checkIn">✅ 出勤：<span>{{ todayRecord.checkIn }}</span></li>
        <li *ngIf="todayRecord.breakOut">⏸ 中途退勤：<span>{{ todayRecord.breakOut }}</span></li>
        <li *ngIf="todayRecord.breakIn">▶️ 中途出勤：<span>{{ todayRecord.breakIn }}</span></li>
        <li *ngIf="todayRecord.checkOut">🏁 退勤：<span>{{ todayRecord.checkOut }}</span></li>
      </ul>
    </div>

    <!-- ✅ 上班总时间 -->
    <div class="worktime" *ngIf="getWorkDuration()">
      ⏰ 今日上班总时间：<strong>{{ getWorkDuration() }}</strong>
    </div>

    <div *ngIf="!todayRecord" class="no-record">今日暂无出勤记录。</div>
  </div>

  <!-- 👥 组员页 -->
  <div *ngIf="currentTab === 'group'">
    <!-- 🚫 未设置姓名或组别时提示 -->
    <div *ngIf="groupAccessDenied" class="profile-warning">
      ⚠️ 您的个人资料未完整，请先在个人信息中填写
      <strong>姓名</strong> 和 <strong>所属组别</strong> 才能查看组员出勤。
    </div>

    <!-- ✅ 已设置资料则显示组员出勤 -->
    <div *ngIf="!groupAccessDenied">
      <h4>组员出勤状况（组别：{{ userGroup }}）</h4>

      <ul class="simple-list" *ngIf="groupMembers.length > 0; else noGroupRecord">
        <li *ngFor="let m of groupMembers">
          <strong>{{ m.name }}</strong>
          <ul>
            <li *ngIf="m.checkIn">出勤：{{ m.checkIn }}</li>
            <li *ngIf="m.breakOut">中途退勤：{{ m.breakOut }}</li>
            <li *ngIf="m.breakIn">中途出勤：{{ m.breakIn }}</li>
            <li *ngIf="m.checkOut">退勤：{{ m.checkOut }}</li>
            <li *ngIf="getWorkDuration()">⏰ 今日上班总时间：{{ getWorkDuration() }}</li>
          </ul>
        </li>
      </ul>



      <ng-template #noGroupRecord>
        <p class="text-muted mt-3">今日暂无组员出勤记录。</p>
      </ng-template>
    </div>
  </div>
</div>